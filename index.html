<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MES ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { min-height: 100vh; background-color: #111827; color: white; padding: 24px; font-family: Arial, sans-serif; }
        .container { max-width: 1280px; margin: 0 auto; }
        .header { margin-bottom: 32px; }
        .header h1 { font-size: 30px; font-weight: bold; margin-bottom: 8px; }
        .header p { color: #9CA3AF; }
        .card-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 32px; }
        .card { background-color: #1F2937; border-radius: 8px; padding: 24px; border: 1px solid #374151; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .icon { width: 24px; height: 24px; font-size: 24px; }
        .status-badge { padding: 4px 12px; border-radius: 9999px; font-size: 14px; font-weight: bold; }
        .status-run { background-color: #10B981; }
        .status-stop { background-color: #EF4444; }
        .card-label { color: #9CA3AF; font-size: 14px; }
        .card-value { font-size: 24px; font-weight: bold; margin-top: 4px; }
        .card-unit { font-size: 18px; color: #9CA3AF; margin-left: 4px; }
        .alarm-badge { background-color: #EF4444; padding: 2px 8px; border-radius: 9999px; font-size: 12px; font-weight: bold; }
        .sensor-section { background-color: #1F2937; border-radius: 8px; padding: 24px; border: 1px solid #374151; margin-bottom: 32px; }
        .sensor-title { font-size: 20px; font-weight: bold; margin-bottom: 24px; }
        .sensor-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; }
        .sensor-item { text-align: center; }
        .sensor-label { color: #9CA3AF; font-size: 14px; margin-bottom: 8px; }
        .sensor-value { font-size: 36px; font-weight: bold; }
        .sensor-unit { color: #6B7280; font-size: 14px; margin-top: 4px; }
        .progress-bar { margin-top: 12px; background-color: #374151; border-radius: 9999px; height: 8px; overflow: hidden; }
        .progress-fill { height: 8px; border-radius: 9999px; transition: width 0.5s; }
        .timestamp { color: #6B7280; font-size: 12px; margin-top: 24px; text-align: right; }
        .chart-section { background-color: #1F2937; border-radius: 8px; padding: 24px; border: 1px solid #374151; }
        .chart-title { font-size: 20px; font-weight: bold; margin-bottom: 24px; }
        @media (max-width: 768px) { .card-grid, .sensor-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MES ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h1>
            <p>ì„¤ë¹„ ID: <span id="equipmentId">EQ-001</span></p>
        </div>
        <div class="card-grid">
            <div class="card">
                <div class="card-header">
                    <span class="icon">ğŸ“Š</span>
                    <span id="statusBadge" class="status-badge status-run">RUN</span>
                </div>
                <p class="card-label">ì„¤ë¹„ ìƒíƒœ</p>
                <p class="card-value" id="statusText">ê°€ë™ì¤‘</p>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="icon">ğŸ“¦</span>
                </div>
                <p class="card-label">ê¸ˆì¼ ìƒì‚°ëŸ‰</p>
                <p class="card-value"><span id="todayProduction">0</span><span class="card-unit">ê°œ</span></p>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="icon">âš ï¸</span>
                    <span id="alarmBadge" class="alarm-badge">0</span>
                </div>
                <p class="card-label">í™œì„± ì•ŒëŒ</p>
                <p class="card-value"><span id="activeAlarm">0</span><span class="card-unit">ê±´</span></p>
            </div>
            <div class="card">
                <div class="card-header">
                    <span class="icon">ğŸ“ˆ</span>
                </div>
                <p class="card-label">ë¶ˆëŸ‰ë¥ </p>
                <p class="card-value"><span id="defectRate">0</span><span class="card-unit">%</span></p>
            </div>
        </div>
        <div class="sensor-section">
            <h2 class="sensor-title">ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„°</h2>
            <div class="sensor-grid">
                <div class="sensor-item">
                    <p class="sensor-label">ì˜¨ë„</p>
                    <p class="sensor-value" id="temperature" style="color: #10B981;">0.0</p>
                    <p class="sensor-unit">Â°C</p>
                    <div class="progress-bar">
                        <div id="tempProgress" class="progress-fill" style="background-color: #10B981; width: 0%;"></div>
                    </div>
                </div>
                <div class="sensor-item">
                    <p class="sensor-label">ì••ë ¥</p>
                    <p class="sensor-value" id="pressure" style="color: #3B82F6;">0.0</p>
                    <p class="sensor-unit">PSI</p>
                    <div class="progress-bar">
                        <div id="pressureProgress" class="progress-fill" style="background-color: #3B82F6; width: 0%;"></div>
                    </div>
                </div>
                <div class="sensor-item">
                    <p class="sensor-label">ì§„ë™</p>
                    <p class="sensor-value" id="vibration" style="color: #8B5CF6;">0.0</p>
                    <p class="sensor-unit">Hz</p>
                    <div class="progress-bar">
                        <div id="vibrationProgress" class="progress-fill" style="background-color: #8B5CF6; width: 0%;"></div>
                    </div>
                </div>
                <div class="sensor-item">
                    <p class="sensor-label">ì†ë„</p>
                    <p class="sensor-value" id="speed" style="color: #06B6D4;">0.0</p>
                    <p class="sensor-unit">RPM</p>
                    <div class="progress-bar">
                        <div id="speedProgress" class="progress-fill" style="background-color: #06B6D4; width: 0%;"></div>
                    </div>
                </div>
            </div>
            <p class="timestamp">ìµœì¢… ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span></p>
        </div>
        <div class="chart-section">
            <h2 class="chart-title">ë¶„ë‹¹ ìƒì‚°ëŸ‰ ì¶”ì´</h2>
            <canvas id="productionChart" height="100" width="1000"></canvas>
        </div>
    </div>
    <script>
        var API_BASE_URL = 'http://localhost:8080/api/dashboard';
        var productionChart = null;
        function updateSensorData(data) {
            document.getElementById('equipmentId').textContent = data.equipmentId;
            var temp = data.temperature.toFixed(1);
            document.getElementById('temperature').textContent = temp;
            var tempColor = data.temperature > 42 ? '#EF4444' : '#10B981';
            document.getElementById('temperature').style.color = tempColor;
            document.getElementById('tempProgress').style.backgroundColor = tempColor;
            document.getElementById('tempProgress').style.width = (data.temperature / 50 * 100) + '%';
            var pressure = data.pressure.toFixed(1);
            document.getElementById('pressure').textContent = pressure;
            var pressureColor = data.pressure > 55 ? '#EF4444' : '#3B82F6';
            document.getElementById('pressure').style.color = pressureColor;
            document.getElementById('pressureProgress').style.backgroundColor = pressureColor;
            document.getElementById('pressureProgress').style.width = (data.pressure / 70 * 100) + '%';
            var vibration = data.vibration.toFixed(1);
            document.getElementById('vibration').textContent = vibration;
            var vibrationColor = data.vibration > 55 ? '#F59E0B' : '#8B5CF6';
            document.getElementById('vibration').style.color = vibrationColor;
            document.getElementById('vibrationProgress').style.backgroundColor = vibrationColor;
            document.getElementById('vibrationProgress').style.width = (data.vibration / 70 * 100) + '%';
            var speed = data.speed.toFixed(1);
            document.getElementById('speed').textContent = speed;
            document.getElementById('speedProgress').style.width = (data.speed / 50 * 100) + '%';
            var date = new Date(data.timestamp);
            document.getElementById('lastUpdate').textContent = date.toLocaleString('ko-KR');
        }
        function updateSummary(data) {
            document.getElementById('statusBadge').textContent = data.equipmentStatus;
            document.getElementById('statusBadge').className = 'status-badge';
            if (data.equipmentStatus === 'RUN') {
                document.getElementById('statusBadge').classList.add('status-run');
                document.getElementById('statusText').textContent = 'ê°€ë™ì¤‘';
            } else if (data.equipmentStatus === 'STOP') {
                document.getElementById('statusBadge').classList.add('status-stop');
                document.getElementById('statusText').textContent = 'ì •ì§€';
            }
            document.getElementById('todayProduction').textContent = data.todayProduction.toLocaleString();
            document.getElementById('activeAlarm').textContent = data.activeAlarmCount;
            document.getElementById('alarmBadge').textContent = data.activeAlarmCount;
            if (data.activeAlarmCount === 0) {
                document.getElementById('alarmBadge').style.display = 'none';
            } else {
                document.getElementById('alarmBadge').style.display = 'inline-block';
            }
            document.getElementById('defectRate').textContent = data.defectRate;
        }
        function updateProductionChart(data) {
            var labels = [];
            var counts = [];
            for (var i = 0; i < data.length; i++) {
                labels.push(data[i][0].substring(11, 16));
                counts.push(data[i][1]);
            }
            if (productionChart) {
                productionChart.destroy();
            }
            var ctx = document.getElementById('productionChart').getContext('2d');
            productionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ìƒì‚°ëŸ‰',
                        data: counts,
                        backgroundColor: '#3B82F6',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#374151' }, ticks: { color: '#9CA3AF' } },
                        x: { grid: { color: '#374151' }, ticks: { color: '#9CA3AF' } }
                    }
                }
            });
        }
        function fetchSensorData() {
            fetch(API_BASE_URL + '/sensor-latest')
                .then(function(response) { return response.json(); })
                .then(function(data) { updateSensorData(data); })
                .catch(function(error) { console.error('ì„¼ì„œ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', error); });
        }
        function fetchSummary() {
            fetch(API_BASE_URL + '/summary')
                .then(function(response) { return response.json(); })
                .then(function(data) { updateSummary(data); })
                .catch(function(error) { console.error('ìš”ì•½ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', error); });
        }
        function fetchProductionChart() {
            fetch(API_BASE_URL + '/production-chart')
                .then(function(response) { return response.json(); })
                .then(function(data) { updateProductionChart(data); })
                .catch(function(error) { console.error('ìƒì‚°ëŸ‰ ì°¨íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:', error); });
        }
        function fetchAllData() {
            fetchSensorData();
            fetchSummary();
            fetchProductionChart();
        }
        window.onload = function() {
            fetchAllData();
            setInterval(fetchSensorData, 2000);
            setInterval(fetchSummary, 5000);
            setInterval(fetchProductionChart, 10000);
        };
    </script>
</body>
</html>
